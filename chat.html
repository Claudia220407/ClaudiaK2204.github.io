<!-- <!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ðŸ’• Chat with You ðŸ’•</title>
    <link rel="stylesheet" href="chat.css" />
  </head>
  <body>
    <div class="chat-container">
      <div class="title-bar">ðŸ’• Chat with Jenna ðŸ’•</div>
      <div id="chat-box"></div>
      <div class="input-container">
        <input type="text" id="user-input" placeholder="Say something..." />
        <button id="send-btn">Send</button>
      </div>
    </div>

    <script>
      const chatBox = document.getElementById("chat-box");
      const userInputField = document.getElementById("user-input");
      const sendButton = document.getElementById("send-btn");

      // Append messages to chat box
      function appendMessage(sender, text) {
        const msg = document.createElement("div");
        const className = sender === "You" ? "message user" : "message bot";
        msg.className = className;
        msg.innerHTML = `<strong>${
          sender === "You" ? "You" : "AI-You"
        }:</strong> ${text}`;
        chatBox.appendChild(msg);
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      // Display the typing indicator
      function showTypingIndicator() {
        const typingIndicator = document.createElement("div");
        typingIndicator.className = "typing-indicator";
        typingIndicator.innerHTML = `<span></span><span></span><span></span>`;
        chatBox.appendChild(typingIndicator);
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      // Remove typing indicator
      function hideTypingIndicator() {
        const typingIndicator = document.querySelector(".typing-indicator");
        if (typingIndicator) {
          typingIndicator.remove();
        }
      }

      async function getAIResponse(userMessage) {
  let attempts = 0;
  const maxRetries = 5; // Maximum number of retries
  const delay = (ms) => new Promise((resolve) => setTimeout(resolve, ms)); // Delay function for retries

  while (attempts < maxRetries) {
    try {
      // Sending the API request to OpenAI's Chat Completion endpoint
      const response = await fetch(
        "https://api.openai.com/v1/chat/completions",
        {
          method: "POST",
          headers: {
            Authorization: `Bearer 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`, // Replace with your API key
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            model: "gpt-3.5-turbo", // You can replace this with your preferred model
            messages: [{ role: "user", content: userMessage }], // User's input message
          }),
        }
      );

      // If the response is rate-limited (429), retry after an exponential backoff
      if (response.status === 429) {
        attempts++;
        const waitTime = Math.pow(2, attempts) * 1000; // Exponential backoff (1s, 2s, 4s, 8s, etc.)
        console.log(`Rate limit exceeded. Retrying in ${waitTime / 1000} seconds...`);
        await delay(waitTime); // Wait before retrying
      } else if (response.ok) {
        // If the request is successful, parse the response and return it
        const data = await response.json();
        return data;
      } else {
        // If the response status is not 429, handle other errors
        throw new Error(`Error: ${response.status} - ${response.statusText}`);
      }
    } catch (error) {
      console.error("Error fetching AI response:", error);
        document.getElementById("chat-box").textContent =
  "The system is currently busy. Please wait a moment and try again.";
    }
  }

  // If retries are exhausted, throw an error and notify the user
  
  throw new Error("Too many retries. Please try again later.");
  
}



      // Function to handle user input and show the response
      async function handleUserInput(userMessage) {
        try {
          const aiResponse = await getAIResponse(userMessage);
          console.log("AI Response:", aiResponse);
          // Display the AI response on the webpage (or however you plan to use it)
          document.getElementById("chat-box").textContent =
            aiResponse.choices[0].message.content;
        } catch (error) {
          console.error("Error:", error);
          document.getElementById("chat-box").textContent =
            "Sorry, something went wrong. Please try again later.";
        }
      }

      // Fix: Corrected the button ID to "send-btn"
      sendButton.addEventListener("click", function () {
        const userMessage = userInputField.value;
        handleUserInput(userMessage);
      });
    </script>
  </body>
</html> -->
